[
  {
    "slug": "posts/2019/enable_docker_on_virtuozzo_7_vps",
    "title": "How To Enable Docker On A Virtuozzo 7 VPS",
    "description": "By default, the required netfilter access to run Docker containers isn't sufficient on Virtuozzo VPSs",
    "date": "2019-03-27T00:00:00.000Z",
    "published": true,
    "tags": [
      "Virtuozzo",
      "Docker",
      "networking",
      "VPS",
      "bridge",
      "netfilter"
    ],
    "body": "const{Fragment:e,jsx:l,jsxs:r}=arguments[0];function _createMdxContent(n){const a={code:\"code\",figcaption:\"figcaption\",figure:\"figure\",p:\"p\",pre:\"pre\",span:\"span\",...n.components};return r(e,{children:[r(a.p,{children:[\"The VPS must be powered down to perform the necessary configuration changes.\\nWe will use VPS container \",l(a.code,{children:\"dockertest.corey-regan.ca\"}),\" for the following instructions.\"]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Stop the running VPS\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# vzctl stop dockertest.corey-regan.ca\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Stopping\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" Container\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" ...\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Container\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" was\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" stopped\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Unmount\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" image:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" /vz/private/e54b18b7-1491-4861-8c7c-9b46ce30852d/root.hdd\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Container\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" is\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" unmounted\"})]})]})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Enable network bridging on the VPS\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl set dockertest.corey-regan.ca --features bridge:on\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#79B8FF\"},children:\"set\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" features:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" bridge:on\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"The\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" CT\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" has\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" been\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" successfully\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" configured.\"})]})]})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Enable full access to netfilter features for the VPS\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl set dockertest.corey-regan.ca --netfilter full\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Set\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" netfilter:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" full\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"The\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" CT\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" has\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" been\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" successfully\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" configured.\"})]})]})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Restart the VPS\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# vzctl start dockertest.corey-regan.ca\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Starting\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" Container\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" ...\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Mount\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" image:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" /vz/private/e54b18b7-1491-4861-8c7c-9b46ce30852d/root.hdd\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Container\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" is\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" mounted\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Setting\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" permissions\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" for\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" image=/vz/private/e54b18b7-1491-4861-8c7c-9b46ce30852d/root.hdd\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Os\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" release:\"}),l(a.span,{style:{color:\"#79B8FF\"},children:\" 3.10.0\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Configure\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" memguarantee:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" 0%\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Setting\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" permissions\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" for\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" image=/vz/private/e54b18b7-1491-4861-8c7c-9b46ce30852d/root.hdd\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"CPU\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" limit:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" 100.0%\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Set\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" up\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" ioprio:\"}),l(a.span,{style:{color:\"#79B8FF\"},children:\" 5\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Adding\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" ip\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" address\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),l(a.span,{style:{color:\"#B392F0\"},children:\"es\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\")\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\":\"}),l(a.span,{style:{color:\"#79B8FF\"},children:\" 204.13.48.99\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Set\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" hostname:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" dockertest.corey-regan.ca\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"File\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" resolv.conf\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" was\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" modified\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Container\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" start\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" progress...\"})]})]})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Install Docker on the VPS, assuming the repo is already configured\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl exec dockertest.corey-regan.ca yum install docker -y\"})]})})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Enable the Docker service for automatic startup on system reboot, and start the Docker service on the VPS\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# \"}),l(a.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"prlctl\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" exec\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" dockertest.corey-regan.ca\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" systemctl\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" enable\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" docker\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),l(a.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"prlctl\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" exec\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" dockertest.corey-regan.ca\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" systemctl\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" start\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" docker\"})]})]})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Verify the Docker service is running as expected on the VPS\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl exec dockertest.corey-regan.ca systemctl status docker\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#F97583\"},children:\"?\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\" docker.service - Docker Application Container Engine\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Loaded:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" loaded\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\" (/usr/lib/systemd/system/docker.service; \"}),l(a.span,{style:{color:\"#B392F0\"},children:\"disabled\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),l(a.span,{style:{color:\"#B392F0\"},children:\"vendor\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" preset:\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" disabled\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]})]})})]}),\"\\n\",r(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[l(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Verify Docker can run the included hello-world container\"}),l(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo \"}),l(a.span,{style:{color:\"#F97583\"},children:\"~\"}),l(a.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl exec dockertest.corey-regan.ca docker run hello-world\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"Hello\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" from\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" Docker!\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[l(a.span,{style:{color:\"#B392F0\"},children:\"This\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" message\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" shows\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" that\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" your\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" installation\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" appears\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" to\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" be\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" working\"}),l(a.span,{style:{color:\"#9ECBFF\"},children:\" correctly.\"})]})]})})]})]})}return{default:function(e={}){const{wrapper:r}=e.components||{};return r?l(r,{...e,children:l(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2019/enable_docker_on_virtuozzo_7_vps"
  },
  {
    "slug": "posts/2019/migrate_esxi4_to_kvm",
    "title": "How To Migrate A VMWare ESXi 4 VM To KVM-Based Virtuozzo 7",
    "description": "Slim chance you're using this old software, but there is hope, the migration can be done!",
    "date": "2019-02-12T00:00:00.000Z",
    "published": true,
    "tags": [
      "Virtuozzo",
      "VPS",
      "migration",
      "VMWare",
      "ESXi",
      "KVM"
    ],
    "body": "const{Fragment:e,jsx:t,jsxs:r}=arguments[0];function _createMdxContent(a){const l={a:\"a\",code:\"code\",figcaption:\"figcaption\",figure:\"figure\",h2:\"h2\",li:\"li\",mark:\"mark\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",ul:\"ul\",...a.components};return r(e,{children:[t(l.p,{children:\"Although this migration was designed to migrate VMs from ESXi 4 to Virtuozzo 7, once the disks are converted to a KVM-compatible qcow2 virtual disk format you can simply use KVM to run the VM.\"}),\"\\n\",t(l.p,{children:\"This article will assume the following host names, please modify the commands to suit your needs.\"}),\"\\n\",r(l.table,{children:[t(l.thead,{children:r(l.tr,{children:[t(l.th,{style:{textAlign:\"right\"},children:\"Host Type\"}),t(l.th,{children:\"Host Name\"})]})}),r(l.tbody,{children:[r(l.tr,{children:[t(l.td,{style:{textAlign:\"right\"},children:t(l.strong,{children:\"ESXi 4 host:\"})}),t(l.td,{children:t(l.code,{children:\"ESXi_HOST\"})})]}),r(l.tr,{children:[t(l.td,{style:{textAlign:\"right\"},children:t(l.strong,{children:\"ESXi 4 VM:\"})}),t(l.td,{children:t(l.code,{children:\"ESXi_VM_NAME\"})})]}),r(l.tr,{children:[t(l.td,{style:{textAlign:\"right\"},children:t(l.strong,{children:\"Virtuozzo 7 host:\"})}),t(l.td,{children:t(l.code,{children:\"Virtuozzo7\"})})]}),r(l.tr,{children:[t(l.td,{style:{textAlign:\"right\"},children:t(l.strong,{children:\"Virtuozzo 7 VM:\"})}),t(l.td,{children:t(l.code,{children:\"ESXi_VM_NAME\"})})]})]})]}),\"\\n\",t(l.h2,{id:\"gotchas\",children:t(l.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#gotchas\",children:\"Gotchas\"})}),\"\\n\",r(l.ul,{children:[\"\\n\",r(l.li,{children:[\"You must use \",t(l.code,{children:\"virt-v2v-copy-to-local\"}),\" instead of \",t(l.code,{children:\"virt-v2v\"}),\" to migrate the VM because we are connecting to an ESXi host and not vSphere. \",t(l.code,{children:\"virt-v2v\"}),\" requires vSphere to export the config.\"]}),\"\\n\",r(l.li,{children:[\"Once migrated, you must rename the file extension of converted virtual disks to \",t(l.code,{children:\"*.hdd\"}),\" in order for KVM/Virtuozzo 7 to recognize the disks to start the VM.\"]}),\"\\n\"]}),\"\\n\",t(l.h2,{id:\"prepare-the-kvmvirtuozzo-host\",children:t(l.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#prepare-the-kvmvirtuozzo-host\",children:\"Prepare The KVM/Virtuozzo Host\"})}),\"\\n\",t(l.p,{children:\"The following instructions will assume you are using Virtuozzo 7, but newer Virtuozzo versions should also work, and a similar procedure should work for KVM hosts.\"}),\"\\n\",r(l.p,{children:[\"Create a new KVM/Virtuozzo VM using same original VM name as the ESXi host's; we'll use \",t(l.code,{children:\"ESXi_VM_NAME\"}),\" for our examples.\"]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"This example assumes the VM is running CentOS 7\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# mkdir -p /vz/private/ESXi_VM_NAME\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl create ESXi_VM_NAME --distribution centos7 --vmtype vm\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Get GUID of new Virtuozzo VM\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl list -a \"}),t(l.span,{style:{color:\"#F97583\"},children:\"|\"}),t(l.span,{style:{color:\"#B392F0\"},children:\" grep\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\" ESXi_VM_NAME\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"{\"}),t(l.span,{style:{color:\"#B392F0\"},children:\"a8bee0ea-9583-42e2-b01e-29274be0be17}\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"  stopped\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"      -\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"               VM\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\" ESXi_VM_NAME\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"List new Virtuozzo VM's disks\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# ls /vz/vmprivate/a8bee0ea-9583-42e2-b01e-29274be0be17/\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#B392F0\"},children:\"config.pvs\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"  config.pvs.backup\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"  harddisk.hdd\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Delete new Virtuozzo VM's empty virtual disk\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl set ESXi_VM_NAME --device-del hdd0 --destroy-image\"})]})})})]}),\"\\n\",t(l.h2,{id:\"esxi-4-to-kvm-migration\",children:t(l.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#esxi-4-to-kvm-migration\",children:\"ESXi 4 to KVM Migration\"})}),\"\\n\",t(l.p,{children:\"Export the ESXi VM's XML config file\"}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"From the ESXi host, export via migration the VM's XML configuration file to the same ESXi host\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@ESXi_HOST \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# virt-v2v-copy-to-local  -v -x -ic esx://root@ESXi_HOST ESXi_VM_NAME\"})]})})})]}),\"\\n\",r(l.p,{children:[\"Now for the main act: migrate and convert the ESXi virtual disk. We will convert the virtual disk to \",t(l.a,{href:\"https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.0/html/technical_reference/qcow2#:~:text=QCOW2%20is%20a%20storage%20format,between%20logical%20and%20physical%20blocks\",children:\"qcow2 format\"}),\" which is supported by both KVM and Virtuozzo 7.\"]}),\"\\n\",r(l.p,{children:[\"Be sure to replace \",t(l.code,{children:\"ESXi_VM_NAME\"}),\" and \",t(l.code,{children:\"NEW_VIRTUOZZO_VM_GUID\"}),\" with your appropriate values.\"]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Migrate ESXi VM's virtual disk to Virtuozzo, performing conversion to qcow2 format\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@ESXi_HOST \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# virt-v2v -i libvirtxml \"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"ESXi_VM_NAME\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\".xml -o \"}),t(l.span,{style:{color:\"#F97583\"},children:\"local\"}),t(l.span,{style:{color:\"#79B8FF\"},children:\" -of\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\" qcow2 \"}),t(l.span,{style:{color:\"#79B8FF\"},children:\"-os\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\" /vz/vmprivate/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"NEW_VIRTUOZZO_VM_GUID\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"/ \"}),t(l.span,{style:{color:\"#79B8FF\"},children:\"-v\"}),t(l.span,{style:{color:\"#79B8FF\"},children:\" -x\"})]})})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Rename migrated virtual disk to *.hdd and import it into KVM/Virtuozzo VM\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# mv /vz/vmprivate/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"NEW_VIRTUOZZO_VM_GUID\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"ESXi_VM_NAME\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"-sda /vz/vmprivate/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"NEW_VIRTUOZZO_VM_GUID\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"ESXi_VM_NAME\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"-sda.hdd\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@Virtuozzo7 \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl set \"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"ESXi_VM_NAME\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\" --device-add hdd --image /vz/vmprivate/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"NEW_VIRTUOZZO_VM_GUID\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"/\"}),t(l.mark,{\"data-highlighted-chars\":\"\",children:t(l.span,{style:{color:\"#E1E4E8\"},children:\"ESXi_VM_NAME\"})}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"-sda.hdd\"})]})]})})]}),\"\\n\",t(l.p,{children:\"Use the KVM/Virtuozzo GUI to configure the migrated VM's hostname, DNS, search domain, routed IP, and any other needed settings.\"}),\"\\n\",r(l.p,{children:[\"You'll need to create the appropriate \",t(l.code,{children:\"ifcfg\"}),\" network script in the migrated VM's \",t(l.code,{children:\"/etc/sysconfig/network-scripts/\"}),\", assuming CentOS 7.\"]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Setup migrated VM's networking. Be sure to use appropriate network addresses\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"[root@ESXi_VM_NAME \"}),t(l.span,{style:{color:\"#F97583\"},children:\"~\"}),t(l.span,{style:{color:\"#E1E4E8\"},children:\"]# nano /etc/sysconfig/network-scripts/ifcfg-eth0\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"ONBOOT\"}),t(l.span,{style:{color:\"#F97583\"},children:\"=\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"yes\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"IPADDR\"}),t(l.span,{style:{color:\"#F97583\"},children:\"=\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"199.204.213.63\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"GATEWAY\"}),t(l.span,{style:{color:\"#F97583\"},children:\"=\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"199.204.213.1\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"NETMASK\"}),t(l.span,{style:{color:\"#F97583\"},children:\"=\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"255.255.255.0\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#E1E4E8\"},children:\"DEVICE\"}),t(l.span,{style:{color:\"#F97583\"},children:\"=\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\"eth0\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Restart migrated VM's network\"}),t(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#B392F0\"},children:\"ifcfg\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\" eth0\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\" down\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[t(l.span,{style:{color:\"#B392F0\"},children:\"ifcfg\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\" eth0\"}),t(l.span,{style:{color:\"#9ECBFF\"},children:\" up\"})]})]})})]})]})}return{default:function(e={}){const{wrapper:r}=e.components||{};return r?t(r,{...e,children:t(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2019/migrate_esxi4_to_kvm"
  },
  {
    "slug": "posts/2019/migrate_virtuozzo4_container_to_virtuozzo6",
    "title": "How To Migrate A Virtuozzo 4 VPS Container To Virtuozzo 6",
    "description": "Slim chance you're using this old software, but there is hope, the migration can be done!",
    "date": "2019-03-27T00:00:00.000Z",
    "published": true,
    "tags": [
      "Virtuozzo",
      "VPS",
      "migration"
    ],
    "body": "const{Fragment:e,jsx:t,jsxs:o}=arguments[0];function _createMdxContent(r){const a={a:\"a\",code:\"code\",figcaption:\"figcaption\",figure:\"figure\",h2:\"h2\",li:\"li\",mark:\"mark\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return o(e,{children:[t(a.p,{children:\"I used to work for a national web host.\\nWhen the parent company that employed me purchased this web host, all the servers were 8-12 years old, with ancient software systems too.\\nOne of my tasks was to migrate all the containers from Virtuozzo 4 into Virtuozzo 7.\\nThrough trial and error I figured out a path to migrate to Virtuozzo 6, and realized that Virtuozzo 7 could still run Virtuozzo 6 containers.\"}),\"\\n\",t(a.p,{children:\"This guide will show you how to migrate from Virtuozzo 4 to Virtuozzo 6.\"}),\"\\n\",t(a.h2,{id:\"virtuozzo-4-to-virtuozzo-6-migration\",children:t(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#virtuozzo-4-to-virtuozzo-6-migration\",children:\"Virtuozzo 4 to Virtuozzo 6 Migration\"})}),\"\\n\",o(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Get the ID of the VPS container to migrate\"}),t(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:o(a.span,{\"data-line\":\"\",children:[t(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo4 \"}),t(a.span,{style:{color:\"#F97583\"},children:\"~\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\"]# vzlist \"}),t(a.span,{style:{color:\"#F97583\"},children:\"|\"}),t(a.span,{style:{color:\"#B392F0\"},children:\" grep\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\" $hostname\"})]})})})]}),\"\\n\",t(a.p,{children:\"To safeguard ourselves from oopsying the customer's original container, we will first copy their container to which we will perform the actual migration.\"}),\"\\n\",o(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Copy the container locally, incrementing the container ID +1\"}),t(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:o(a.span,{\"data-line\":\"\",children:[t(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo4 \"}),t(a.span,{style:{color:\"#F97583\"},children:\"~\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\"]# vzmlocal -C 4095064:\"}),t(a.mark,{\"data-highlighted-chars\":\"\",children:t(a.span,{style:{color:\"#E1E4E8\"},children:\"4095065\"})})]})})})]}),\"\\n\",o(a.p,{children:[\"We need to convert from the old disk format to the new \",t(a.a,{href:\"https://wiki.openvz.org/Ploop/format\",children:\"ploop disk format\"}),\". We can do this while migrating the container to the new Virtuozzo 6 server. If this is the first of many containers you need to migrate, do a dry-run first.\"]}),\"\\n\",t(a.p,{children:\"There are a few things to note:\"}),\"\\n\",o(a.ul,{children:[\"\\n\",t(a.li,{children:\"We are migrating the copy of the original container, not the original container itself\"}),\"\\n\",o(a.li,{children:[t(a.code,{children:\"--readonly\"}),\" leaves the files intact on the Virtuozzo 4 host after migration, but stops the container on the Virtuozzo 4 host after completing the transfer to the Virtuozzo 6 host.\"]}),\"\\n\",o(a.li,{children:[t(a.code,{children:\"--online\"}),\" keeps the container online, does a cut-over, and deletes it from the Virtuozzo 4 server. \",t(a.strong,{children:\"This is destructive, this is why we migrate the copied container and not the original container\"})]}),\"\\n\",o(a.li,{children:[\"You can't use \",t(a.code,{children:\"--online\"}),\" && \",t(a.code,{children:\"--readonly\"}),' together, error: \"',t(a.code,{children:\"1534365354: Can't use --online option with --readonly option\"}),'\"']}),\"\\n\"]}),\"\\n\",o(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Migration dry-run with ploop disk conversion\"}),t(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:o(a.span,{\"data-line\":\"\",children:[t(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo4 \"}),t(a.span,{style:{color:\"#F97583\"},children:\"~\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\"]# vzmigrate --remove-area no --nostart --keep-dst --readonly --convert-vzfs --verbose --dry-run root@virtuozzo6 \"}),t(a.mark,{\"data-highlighted-chars\":\"\",children:t(a.span,{style:{color:\"#E1E4E8\"},children:\"4095065\"})})]})})})]}),\"\\n\",o(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Actually LIVE migrate the container with ploop disk conversion\"}),t(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:o(a.span,{\"data-line\":\"\",children:[t(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo4 \"}),t(a.span,{style:{color:\"#F97583\"},children:\"~\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\"]# vzmigrate --remove-area no --nostart --keep-dst --convert-vzfs --verbose --online root@virtuozzo6 \"}),t(a.mark,{\"data-highlighted-chars\":\"\",children:t(a.span,{style:{color:\"#E1E4E8\"},children:\"4095065\"})})]})})})]}),\"\\n\",t(a.h2,{id:\"virtuozzo-6-to-virtuozzo-78-migration\",children:t(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#virtuozzo-6-to-virtuozzo-78-migration\",children:\"Virtuozzo 6 to Virtuozzo 7/8 Migration\"})}),\"\\n\",t(a.p,{children:\"At this time, you can optionally migrate the container to a Virtuozzo 7 host which is still capable of running Virtuozzo 6 containers. ChatGPT says Virtuozzo 8 can also support Virtuozzo 6 containers, but I have not tested this.\"}),\"\\n\",o(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Migrate the Virtuozzo 6 container to Virtuozzo 7/8\"}),t(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:o(a.span,{\"data-line\":\"\",children:[t(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo6 \"}),t(a.span,{style:{color:\"#F97583\"},children:\"~\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\"]# pmigrate c 4095065 c root@virtuozzo7\"})]})})})]}),\"\\n\",t(a.h2,{id:\"troubleshooting\",children:t(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#troubleshooting\",children:\"Troubleshooting\"})}),\"\\n\",o(a.p,{children:[\"You might get the following error when trying to start the container on the Virtuozzo 6 host: \",t(a.code,{children:\"vcmmd: failed to activate Container: VE not registered\"}),\". If you dig into the logs you'll likely find memory allocation entries. Simply ensure the host has adequate memory assigned.\"]}),\"\\n\",o(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[t(a.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Assign more memory to the container\"}),t(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:t(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:o(a.span,{\"data-line\":\"\",children:[t(a.span,{style:{color:\"#E1E4E8\"},children:\"[root@virtuozzo7 \"}),t(a.span,{style:{color:\"#F97583\"},children:\"~\"}),t(a.span,{style:{color:\"#E1E4E8\"},children:\"]# prlctl set 4095065 --memsize 4072M\"})]})})})]})]})}return{default:function(e={}){const{wrapper:o}=e.components||{};return o?t(o,{...e,children:t(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2019/migrate_virtuozzo4_container_to_virtuozzo6"
  },
  {
    "slug": "posts/2019/replace_r1soft_ssl_certificate",
    "title": "How To Replace R1Soft SSL/TLS Certificate",
    "description": "R1Soft runs on Java and doesn't make it easy to replace certificates",
    "date": "2019-02-12T00:00:00.000Z",
    "published": true,
    "tags": [
      "certificate",
      "SSL",
      "TLS",
      "R1Soft",
      "backups",
      "Java"
    ],
    "body": "const{Fragment:e,jsx:a,jsxs:r}=arguments[0];function _createMdxContent(t){const l={code:\"code\",figcaption:\"figcaption\",figure:\"figure\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",table:\"table\",tbody:\"tbody\",td:\"td\",th:\"th\",thead:\"thead\",tr:\"tr\",...t.components};return r(e,{children:[a(l.p,{children:\"This article will assume your private key is not password-protected, and the following filenames. Please adjust the example commands or rename your files.\"}),\"\\n\",r(l.table,{children:[a(l.thead,{children:r(l.tr,{children:[a(l.th,{style:{textAlign:\"right\"},children:\"Cert Type\"}),a(l.th,{children:\"File Name\"})]})}),r(l.tbody,{children:[r(l.tr,{children:[a(l.td,{style:{textAlign:\"right\"},children:a(l.strong,{children:\"Private key:\"})}),a(l.td,{children:\"PrivateKeyNoPassphrase.key\"})]}),r(l.tr,{children:[a(l.td,{style:{textAlign:\"right\"},children:a(l.strong,{children:\"Public certificate:\"})}),a(l.td,{children:\"PublicWildcard.domain.tld.crt\"})]}),r(l.tr,{children:[a(l.td,{style:{textAlign:\"right\"},children:a(l.strong,{children:\"Public cert authority intermediate cert:\"})}),a(l.td,{children:\"PublicIntermediate-ca.crt\"})]})]})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Install prerequisites\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#79B8FF\"},children:\"cd\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" ~\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#B392F0\"},children:\"yum\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -y\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" unzip\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" wget\"})]})})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Ensure private key & certs are present\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"vim\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" PrivateKeyNoPassphrase.key\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"vim\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" PublicWildcard.domain.tld.crt\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"vim\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" PublicIntermediate-ca.crt\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Convert PEM format key/cert to DER format\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"openssl\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" pkcs8\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -topk8\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -nocrypt\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -in\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PrivateKeyNoPassphrase.key\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -inform\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" PEM\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -out\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PrivateKeyNoPassphrase.key.der\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -outform\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" DER\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"openssl\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" x509\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -in\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PublicWildcard.domain.tld.crt\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -inform\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" PEM\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -out\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PublicWildcard.domain.tld.crt.der\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -outform\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" DER\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Prepare R1Soft folders\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#79B8FF\"},children:\"cd\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /usr/sbin/r1soft/jre/bin\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#B392F0\"},children:\"chmod\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" 755\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" java\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" keytool\"})]})})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Download and install importkey utility to import keys into a keystore\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"wget\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" http://igniterealtime.jiveon.com/servlet/JiveServlet/download/196707-4718/importkey.zip\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"unzip\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" importkey.zip\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Import private key and public cert into keystore\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"./java\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" ImportKey\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PrivateKeyNoPassphrase.key.der\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PublicWildcard.domain.tld.crt.der\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" cdp\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"./keytool\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -storepasswd\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -keystore\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/keystore.ImportKey\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"./keytool\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -keypasswd\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -alias\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" cdp\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -keystore\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/keystore.ImportKey\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Import intermediate cert into keystore\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"mv\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/keystore.ImportKey\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/keystore\"}),a(l.span,{style:{color:\"#E1E4E8\"},children:\" && \"}),a(l.span,{style:{color:\"#79B8FF\"},children:\"\\\\\"})]}),\"\\n\",r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"./keytool\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -import\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -alias\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" intermed\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -file\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/PublicIntermediate-ca.crt\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -keystore\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/keystore\"}),a(l.span,{style:{color:\"#79B8FF\"},children:\" -trustcacerts\"})]})]})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Backup old R1Soft keystore\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"mv\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /usr/sbin/r1soft/conf/keystore{,.bak}\"})]})})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Install new keystore into R1Soft\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"cp\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /root/keystore\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" /usr/sbin/r1soft/conf/keystore\"})]})})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Restart R1Soft\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:r(l.span,{\"data-line\":\"\",children:[a(l.span,{style:{color:\"#B392F0\"},children:\"service\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" cdp-server\"}),a(l.span,{style:{color:\"#9ECBFF\"},children:\" restart\"})]})})})]}),\"\\n\",r(l.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(l.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Speed-run the cert import password prompts with this order:\"}),a(l.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(l.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"importkey\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"password\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"password\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"password\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"importkey\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"password\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"password\"})}),\"\\n\",a(l.span,{\"data-line\":\"\",children:a(l.span,{style:{color:\"#B392F0\"},children:\"password\"})})]})})]})]})}return{default:function(e={}){const{wrapper:r}=e.components||{};return r?a(r,{...e,children:a(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2019/replace_r1soft_ssl_certificate"
  },
  {
    "slug": "posts/2020/selinux_for_web_servers",
    "title": "How To Configure SELinux For Web Servers",
    "description": "SELinux blocks basic web server features by default, this is how you allow them",
    "date": "2020-06-16T00:00:00.000Z",
    "published": true,
    "tags": [
      "RHEL",
      "RedHat",
      "CentOS",
      "security",
      "SELinux",
      "www"
    ],
    "body": "const{Fragment:e,jsx:a,jsxs:t}=arguments[0];function _createMdxContent(r){const n={a:\"a\",code:\"code\",figcaption:\"figcaption\",figure:\"figure\",h2:\"h2\",p:\"p\",pre:\"pre\",span:\"span\",...r.components};return t(e,{children:[a(n.p,{children:\"SELinux is good at not allowing anything to happen on a system unless it is authorized.\\nHere are a few handy commands that help me get a new web server up and running, and allowing its websites to send emails.\"}),\"\\n\",a(n.h2,{id:\"web-servers\",children:a(n.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#web-servers\",children:\"Web Servers\"})}),\"\\n\",t(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(n.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Restore default permissions to www folders/files\"}),a(n.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:t(n.span,{\"data-line\":\"\",children:[a(n.span,{style:{color:\"#B392F0\"},children:\"chcon\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" -Rv\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" --user\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" system_u\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" --type\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" httpd_sys_content_t\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" /var/www/html/folder/or/file\"})]})})})]}),\"\\n\",t(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(n.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Make www folders/files writable\"}),a(n.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:t(n.span,{\"data-line\":\"\",children:[a(n.span,{style:{color:\"#B392F0\"},children:\"chcon\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" -R\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" -t\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" httpd_sys_rw_content_t\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" /var/www/html/folder/or/file\"})]})})})]}),\"\\n\",a(n.h2,{id:\"postfix-mail-server\",children:a(n.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#postfix-mail-server\",children:\"Postfix Mail Server\"})}),\"\\n\",a(n.p,{children:\"To allow HTTPd to send mail via Postfix, there is a SELinux boolean to set.\"}),\"\\n\",t(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(n.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"verify functionality is disabled\"}),a(n.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:t(n.span,{\"data-line\":\"\",children:[a(n.span,{style:{color:\"#B392F0\"},children:\"getsebool\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" httpd_can_sendmail\"})]})})})]}),\"\\n\",t(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(n.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"If false (disabled), enable it. The -P flag denotes persistence (setting survives reboots)\"}),a(n.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:t(n.span,{\"data-line\":\"\",children:[a(n.span,{style:{color:\"#B392F0\"},children:\"setsebool\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" -P\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" httpd_can_sendmail\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" 1\"})]})})})]}),\"\\n\",t(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(n.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Can also restore SELinux context to main.cf\"}),a(n.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:t(n.span,{\"data-line\":\"\",children:[a(n.span,{style:{color:\"#B392F0\"},children:\"restorecon\"}),a(n.span,{style:{color:\"#79B8FF\"},children:\" -v\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" /etc/postfix/main.cf\"})]})})})]}),\"\\n\",t(n.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(n.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:\"Reset Postfix permissions\"}),a(n.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:a(n.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:t(n.span,{\"data-line\":\"\",children:[a(n.span,{style:{color:\"#B392F0\"},children:\"postfix\"}),a(n.span,{style:{color:\"#9ECBFF\"},children:\" set-permissions\"})]})})})]})]})}return{default:function(e={}){const{wrapper:t}=e.components||{};return t?a(t,{...e,children:a(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2020/selinux_for_web_servers"
  },
  {
    "slug": "posts/2024/connect_to_mssql_from_ubuntu_22",
    "title": "How To Connect To A MSSQL Server From Ubuntu 22",
    "description": "Setting up the Microsoft repo and installing the right packages is just the beginning",
    "date": "2024-05-09T00:00:00.000Z",
    "published": true,
    "tags": [
      "MSSQL",
      "Azure",
      "Ubuntu"
    ],
    "body": "const{Fragment:e,jsx:a,jsxs:n}=arguments[0];function _createMdxContent(t){const r={a:\"a\",code:\"code\",figcaption:\"figcaption\",figure:\"figure\",h2:\"h2\",h3:\"h3\",p:\"p\",pre:\"pre\",span:\"span\",...t.components};return n(e,{children:[a(r.h2,{id:\"install-microsoft-server-tools-the-right-way\",children:a(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-microsoft-server-tools-the-right-way\",children:\"Install Microsoft Server tools, the right way\"})}),\"\\n\",a(r.p,{children:\"Skip all of my struggles, just punch in these commands one line at a time.\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Assuming you are logged in as root, and have wget installed\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"mkdir -p /root/.gnupg/S.dirmngr && chmod 600 /root/.gnupg/\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"wget -qO /etc/apt/sources.list.d/mssql-prod.list https://packages.microsoft.com/config/ubuntu/22.04/mssql-prod.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"sed -i 's/\\\\(deb \\\\[arch=[^]]*\\\\)/\\\\1 signed-by=\\\\/usr\\\\/share\\\\/keyrings\\\\/mssql-archive-keyring.gpg/' /etc/apt/sources.list.d/mssql-prod.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"apt update\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"apt install mssql-tools\"})})]})})]}),\"\\n\",a(r.h2,{id:\"install-microsoft-server-tools-the-wrong-way\",children:a(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-microsoft-server-tools-the-wrong-way\",children:\"Install Microsoft Server tools, the wrong way\"})}),\"\\n\",a(r.p,{children:\"I've documented all the wrong ways of getting this configured in case somebody else follows bad instructions and gets stuck.\"}),\"\\n\",a(r.h3,{id:\"add-the-microsoft-apt-repository\",children:a(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#add-the-microsoft-apt-repository\",children:\"Add the Microsoft apt repository\"})}),\"\\n\",a(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:'# add-apt-repository \"$(wget -qO- https://packages.microsoft.com/config/ubuntu/22.04/mssql-prod.list)\"'})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Repository: 'deb [arch=amd64,armhf,arm64] https://packages.microsoft.com/ubuntu/22.04/prod jammy main'\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Description:\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Archive for codename: jammy components: main\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"More info: https://packages.microsoft.com/ubuntu/22.04/prod\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Adding repository.\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Press [ENTER] to continue or Ctrl-c to cancel.\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Adding deb entry to /etc/apt/sources.list.d/archive_uri-https_packages_microsoft_com_ubuntu_22_04_prod-jammy.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Adding disabled deb-src entry to /etc/apt/sources.list.d/archive_uri-https_packages_microsoft_com_ubuntu_22_04_prod-jammy.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:1 https://download.docker.com/linux/ubuntu jammy InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:2 https://dl.google.com/linux/chrome/deb stable InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:3 http://ca.archive.ubuntu.com/ubuntu jammy-backports InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Err:8 https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Reading package lists... Done\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"W: GPG error: https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"E: The repository 'https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease' is not signed.\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"N: Updating from such a repository can't be done securely, and is therefore disabled by default.\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"N: See apt-secure(8) manpage for repository creation and user configuration details.\"})})]})})}),\"\\n\",a(r.h3,{id:\"add-the-signing-gpg-key\",children:a(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#add-the-signing-gpg-key\",children:\"Add the signing GPG key\"})}),\"\\n\",a(r.p,{children:\"Notice at the end the error about the repo not being signed? Let's import Microsoft's signing key into a new GPG keyring.\\nNext we'll use Ubuntu's official keyserver to import the key needed to verify the integrity of the MSSQL repo.\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Don't use the deprecated apt-key command, use GPG keyrings instead\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# sudo gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg: failed to create temporary file '/root/.gnupg/.#lk0x000062230980e220.InvinciCODE.1056950': No such file or directory\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg: connecting dirmngr at '/root/.gnupg/S.dirmngr' failed: No such file or directory\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg: keyserver receive failed: No dirmngr\"})})]})})]}),\"\\n\",a(r.p,{children:\"We can create the missing directory and re-run the command\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Note the unsafe permissions, we will fix them\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# mkdir -p /root/.gnupg/S.dirmngr\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg: WARNING: unsafe permissions on homedir '/root/.gnupg'\"})})]})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Let's fix the directory permissions and try again\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# chmod 600 /root/.gnupg/\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:'gpg: key EB3E94ADBE1229CF: \"Microsoft (Release signing) <gpgsecurity@microsoft.com>\" not changed'})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg: Total number processed: 1\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"gpg:              unchanged: 1\"})})]})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Try again\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# apt update\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:1 https://download.docker.com/linux/ubuntu jammy InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:2 https://dl.google.com/linux/chrome/deb stable InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:3 https://deb.nodesource.com/node_20.x nodistro InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Get:5 https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease [3,624 B]\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"(redacted)\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"W: An error occurred during the signature verification. The repository is not updated and the previous index files will be used. GPG error: https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"W: Failed to fetch https://packages.microsoft.com/ubuntu/22.04/prod/dists/jammy/InRelease  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"W: Some index files failed to download. They have been ignored, or old ones used instead.\"})})]})})]}),\"\\n\",a(r.h3,{id:\"configure-the-apt-repo-to-use-the-gpg-key\",children:a(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-the-apt-repo-to-use-the-gpg-key\",children:\"Configure the apt repo to use the GPG key\"})}),\"\\n\",a(r.p,{children:\"At this point we have the repo added, we have the singing key added to a new keyring, but the repo isn't configured to reference the new signing GPG keyring.\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Find the name of the MSSQL repo file, rename it to something easy\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# ls /etc/apt/sources.list.d/ | grep -i mssql\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"archive_uri-https_packages_microsoft_com_ubuntu_22_04_prod-jammy.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# mv /etc/apt/sources.list.d/archive_uri-https_packages_microsoft_com_ubuntu_22_04_prod-jammy.list /etc/apt/sources.list.d/mssql-prod.list\"})})]})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Lets inspect the repo, notice the missing reference to our MSSQL GPG keyring?\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# cat /etc/apt/sources.list.d/mssql-prod.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"deb [arch=amd64,armhf,arm64] https://packages.microsoft.com/ubuntu/22.04/prod jammy main\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# deb-src [arch=amd64,armhf,arm64] https://packages.microsoft.com/ubuntu/22.04/prod jammy main\"})})]})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Use SED or your favorite text editor to add a reference to the MSSQL GPG keyring\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# sed -i 's/\\\\(deb \\\\[arch=[^]]*\\\\)/\\\\1 signed-by=\\\\/usr\\\\/share\\\\/keyrings\\\\/mssql-archive-keyring.gpg/g' /etc/apt/sources.list.d/mssql-prod.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# cat /etc/apt/sources.list.d/mssql-prod.list\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"deb [arch=amd64,armhf,arm64 signed-by=/usr/share/keyrings/mssql-archive-keyring.gpg] https://packages.microsoft.com/ubuntu/22.04/prod jammy main\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# deb-src [arch=amd64,armhf,arm64 signed-by=/usr/share/keyrings/mssql-archive-keyring.gpg] https://packages.microsoft.com/ubuntu/22.04/prod jammy main\"})})]})})]}),\"\\n\",a(r.h3,{id:\"finally-install-mssql-tools\",children:a(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#finally-install-mssql-tools\",children:\"Finally, install MSSQL tools\"})}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Refresh available apt packages\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# apt update\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:1 https://download.docker.com/linux/ubuntu jammy InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:2 http://ca.archive.ubuntu.com/ubuntu jammy InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Hit:3 http://security.ubuntu.com/ubuntu jammy-security InRelease\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Get:4 https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease [3,624 B]\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"(redacted)\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Fetched 7,220 B in 1s (6,134 B/s)\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Reading package lists... Done\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Building dependency tree... Done\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"Reading state information... Done\"})})]})})]}),\"\\n\",a(r.p,{children:\"Finally! We have successfully securely configured the MSSQL Server 2022 repository. Now we can move onto installing MSSQL Server 2022.\"}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Finally, install MSSQL tools\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:a(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# apt install mssql-tools\"})})})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Add MSSQL tools to $PATH\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(r.span,{\"data-line\":\"\",children:a(r.span,{children:'# export PATH=\"$PATH:/opt/mssql-tools/bin\"'})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# which sqlcmd\"})}),\"\\n\",a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"/opt/mssql-tools/bin/sqlcmd\"})})]})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Persist new $PATH across reboots\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:a(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# echo 'export PATH=\\\"$PATH:/opt/mssql-tools/bin\\\"' >> ~/.bash_profile\"})})})})]}),\"\\n\",n(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(r.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Connect to your MSSQL server\"}),a(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:a(r.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:a(r.span,{\"data-line\":\"\",children:a(r.span,{children:\"# sqlcmd -S <hostname_or_IP>,<port> -U <username> -P <password>\"})})})})]})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?a(n,{...e,children:a(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2024/connect_to_mssql_from_ubuntu_22"
  },
  {
    "slug": "posts/2024/install_mssql_on_ubuntu_22",
    "title": "How To Install MSSQL Server On Ubuntu 22",
    "description": "Setting up the Microsoft repo and installing the right packages is just the beginning",
    "date": "2024-05-09T00:00:00.000Z",
    "published": true,
    "tags": [
      "MSSQL",
      "Ubuntu",
      "apt",
      "GPG"
    ],
    "body": "const{Fragment:e,jsx:a,jsxs:n}=arguments[0];function _createMdxContent(r){const t={a:\"a\",code:\"code\",figcaption:\"figcaption\",figure:\"figure\",h2:\"h2\",h3:\"h3\",p:\"p\",pre:\"pre\",span:\"span\",...r.components};return n(e,{children:[a(t.h2,{id:\"install-microsoft-server-2022-the-wrong-way\",children:a(t.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-microsoft-server-2022-the-wrong-way\",children:\"Install Microsoft Server 2022, the wrong way\"})}),\"\\n\",n(t.p,{children:[\"I've documented all the wrong ways of getting this configured. \",a(t.a,{href:\"#InstallMicrosoftServer2022,therightway\",children:\"Jump to the right way section\"}),\" for a quick how-to.\"]}),\"\\n\",a(t.h3,{id:\"add-the-microsoft-apt-repository\",children:a(t.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#add-the-microsoft-apt-repository\",children:\"Add the Microsoft apt repository\"})}),\"\\n\",a(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:'# add-apt-repository \"$(wget -qO- https://packages.microsoft.com/config/ubuntu/22.04/mssql-server-2022.list)\"'})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Repository: 'deb [arch=amd64,armhf,arm64] https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy main'\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Description:\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Archive for codename: jammy components: main\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"More info: https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Adding repository.\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Press [ENTER] to continue or Ctrl-c to cancel.\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Adding deb entry to /etc/apt/sources.list.d/archive_uri-https_packages_microsoft_com_ubuntu_22_04_mssql-server-2022-jammy.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Adding disabled deb-src entry to /etc/apt/sources.list.d/archive_uri-https_packages_microsoft_com_ubuntu_22_04_mssql-server-2022-jammy.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:1 https://download.docker.com/linux/ubuntu jammy InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:2 https://dl.google.com/linux/chrome/deb stable InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:3 http://ca.archive.ubuntu.com/ubuntu jammy-backports InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Err:8 https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Reading package lists... Done\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"W: GPG error: https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"E: The repository 'https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy InRelease' is not signed.\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"N: Updating from such a repository can't be done securely, and is therefore disabled by default.\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"N: See apt-secure(8) manpage for repository creation and user configuration details.\"})})]})})}),\"\\n\",a(t.h3,{id:\"add-the-signing-gpg-key\",children:a(t.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#add-the-signing-gpg-key\",children:\"Add the signing GPG key\"})}),\"\\n\",a(t.p,{children:\"Notice at the end the error about the repo not being signed? Let's import Microsoft's signing key into a new GPG keyring.\\nNext we'll use Ubuntu's official keyserver to import the key needed to verify the integrity of the MSSQL repo.\"}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Don't use the deprecated apt-key command, use GPG keyrings instead\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# sudo gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg: failed to create temporary file '/root/.gnupg/.#lk0x000062230980e220.InvinciCODE.1056950': No such file or directory\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg: connecting dirmngr at '/root/.gnupg/S.dirmngr' failed: No such file or directory\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg: keyserver receive failed: No dirmngr\"})})]})})]}),\"\\n\",a(t.p,{children:\"We can create the missing directory and re-run the command\"}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Note the unsafe permissions, we will fix them\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# mkdir -p /root/.gnupg/S.dirmngr\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg: WARNING: unsafe permissions on homedir '/root/.gnupg'\"})})]})})]}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Let's fix the directory permissions and try again\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# chmod 600 /root/.gnupg/\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:'gpg: key EB3E94ADBE1229CF: \"Microsoft (Release signing) <gpgsecurity@microsoft.com>\" not changed'})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg: Total number processed: 1\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg:              unchanged: 1\"})})]})})]}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Try again\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# apt update\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:1 https://download.docker.com/linux/ubuntu jammy InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:2 https://dl.google.com/linux/chrome/deb stable InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:3 https://deb.nodesource.com/node_20.x nodistro InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Get:5 https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy InRelease [3,624 B]\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"(redacted)\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"W: An error occurred during the signature verification. The repository is not updated and the previous index files will be used. GPG error: https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy InRelease: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"W: Failed to fetch https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022/dists/jammy/InRelease  The following signatures couldn't be verified because the public key is not available: NO_PUBKEY EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"W: Some index files failed to download. They have been ignored, or old ones used instead.\"})})]})})]}),\"\\n\",a(t.h3,{id:\"configure-the-apt-repo-to-use-the-gpg-key\",children:a(t.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-the-apt-repo-to-use-the-gpg-key\",children:\"Configure the apt repo to use the GPG key\"})}),\"\\n\",a(t.p,{children:\"At this point we have the repo added, we have the singing key added to a new keyring, but the repo isn't configured to reference the new signing GPG keyring.\"}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Find the name of the MSSQL repo file, rename it to something easy\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# ls /etc/apt/sources.list.d/ | grep -i mssql\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"archive_uri-https_packages_microsoft_com_ubuntu_22_04_mssql-server-2022-jammy.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# mv /etc/apt/sources.list.d/archive_uri-https_packages_microsoft_com_ubuntu_22_04_mssql-server-2022-jammy.list /etc/apt/sources.list.d/mssql-server-2022.list\"})})]})})]}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Lets inspect the repo, notice the missing reference to our MSSQL GPG keyring?\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# cat /etc/apt/sources.list.d/mssql-server-2022.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"deb [arch=amd64,armhf,arm64] https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy main\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# deb-src [arch=amd64,armhf,arm64] https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy main\"})})]})})]}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Use SED or your favorite text editor to add a reference to the MSSQL GPG keyring\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# sed -i 's/\\\\(deb \\\\[arch=[^]]*\\\\)/\\\\1 signed-by=\\\\/usr\\\\/share\\\\/keyrings\\\\/mssql-archive-keyring.gpg/g' /etc/apt/sources.list.d/mssql-server-2022.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# cat /etc/apt/sources.list.d/mssql-server-2022.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"deb [arch=amd64,armhf,arm64 signed-by=/usr/share/keyrings/mssql-archive-keyring.gpg] https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy main\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# deb-src [arch=amd64,armhf,arm64 signed-by=/usr/share/keyrings/mssql-archive-keyring.gpg] https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy main\"})})]})})]}),\"\\n\",a(t.h3,{id:\"finally-install-mssql-server-2022\",children:a(t.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#finally-install-mssql-server-2022\",children:\"Finally, install MSSQL Server 2022\"})}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Refresh available apt packages\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# apt update\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:1 https://download.docker.com/linux/ubuntu jammy InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:2 http://ca.archive.ubuntu.com/ubuntu jammy InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Hit:3 http://security.ubuntu.com/ubuntu jammy-security InRelease\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Get:4 https://packages.microsoft.com/ubuntu/22.04/mssql-server-2022 jammy InRelease [3,624 B]\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"(redacted)\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Fetched 7,220 B in 1s (6,134 B/s)\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Reading package lists... Done\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Building dependency tree... Done\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"Reading state information... Done\"})})]})})]}),\"\\n\",a(t.p,{children:\"Finally! We have successfully securely configured the MSSQL Server 2022 repository. Now we can move onto installing MSSQL Server 2022.\"}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Finally, install MSSQL Server 2022\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:a(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"# apt install mssql-server\"})})})})]}),\"\\n\",a(t.h2,{id:\"install-microsoft-server-2022-the-right-way\",children:a(t.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-microsoft-server-2022-the-right-way\",children:\"Install Microsoft Server 2022, the right way\"})}),\"\\n\",a(t.p,{children:\"Skip all of my struggles, just punch in these commands one line at a time\"}),\"\\n\",n(t.figure,{\"data-rehype-pretty-code-figure\":\"\",children:[a(t.figcaption,{\"data-rehype-pretty-code-title\":\"\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:\"Assuming you are logged in as root, and have wget installed\"}),a(t.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",children:n(t.code,{\"data-language\":\"bash,\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"mkdir -p /root/.gnupg/S.dirmngr && chmod 600 /root/.gnupg/\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"gpg --no-default-keyring --keyring /usr/share/keyrings/mssql-archive-keyring.gpg --keyserver keyserver.ubuntu.com --recv-keys EB3E94ADBE1229CF\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"wget -qO /etc/apt/sources.list.d/mssql-server-2022.list https://packages.microsoft.com/config/ubuntu/22.04/mssql-server-2022.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"sed -i 's/\\\\(deb \\\\[arch=[^]]*\\\\)/\\\\1 signed-by=\\\\/usr\\\\/share\\\\/keyrings\\\\/mssql-archive-keyring.gpg/' /etc/apt/sources.list.d/mssql-server-2022.list\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"apt update\"})}),\"\\n\",a(t.span,{\"data-line\":\"\",children:a(t.span,{children:\"apt install mssql-server\"})})]})})]}),\"\\n\",n(t.p,{children:[\"I recommend following the remaining instructions here to configure your new MSSQL DB: \",a(t.a,{href:\"https://idroot.us/install-microsoft-sql-server-ubuntu-22-04/\",children:\"https://idroot.us/install-microsoft-sql-server-ubuntu-22-04/\"})]})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?a(n,{...e,children:a(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2024/install_mssql_on_ubuntu_22"
  },
  {
    "slug": "posts/2024/kubectl_context_management",
    "title": "How To Manage Multiple Kubernetes Clusters With kubectl",
    "description": "Kubectl allows you to manage multiple k8s clusters by adding and switching config contexts",
    "date": "2024-05-06T00:00:00.000Z",
    "published": false,
    "tags": [
      "kubernetes",
      "kubectl"
    ],
    "body": "const{Fragment:e,jsx:l,jsxs:n}=arguments[0];function _createMdxContent(c){const r={a:\"a\",code:\"code\",figure:\"figure\",h2:\"h2\",p:\"p\",pre:\"pre\",span:\"span\",...c.components};return n(e,{children:[l(r.h2,{id:\"kubectl-config-commands\",children:l(r.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#kubectl-config-commands\",children:\"Kubectl config commands\"})}),\"\\n\",n(r.p,{children:[l(r.code,{children:\"kubectl config\"}),\" allows us to manage the configs of the various k8s clusters we manage.\\nHere's a quick list of available commands, of which we will focus on \",l(r.code,{children:\"clusters\"}),\" and \",l(r.code,{children:\"contexts\"}),\":\"]}),\"\\n\",l(r.figure,{\"data-rehype-pretty-code-figure\":\"\",children:l(r.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(r.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"kubectl\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" config\"}),l(r.span,{style:{color:\"#79B8FF\"},children:\" -h\"})]}),\"\\n\",l(r.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"Available\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" Commands:\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  current-context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"   Display\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" current-context\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  delete-cluster\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"    Delete\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" specified\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" cluster\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" from\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  delete-context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"    Delete\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" specified\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" from\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  delete-user\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"       Delete\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" specified\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" user\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" from\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  get-clusters\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"      Display\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" clusters\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" defined\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  get-contexts\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"      Describe\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" one\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" or\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" many\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" contexts\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  get-users\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"         Display\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" users\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" defined\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  rename-context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"    Rename\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" from\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" file\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#79B8FF\"},children:\"  set\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"               Set\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" an\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" individual\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" value\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" file\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  set-cluster\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"       Set\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" cluster\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" entry\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  set-context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"       Set\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" entry\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  set-credentials\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"   Set\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" user\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" entry\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#79B8FF\"},children:\"  unset\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"             Unset\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" an\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" individual\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" value\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" file\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  use-context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"       Set\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" current-context\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" file\"})]}),\"\\n\",n(r.span,{\"data-line\":\"\",children:[l(r.span,{style:{color:\"#B392F0\"},children:\"  view\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\"              Display\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" merged\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" settings\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" or\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" a\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" specified\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" kubeconfig\"}),l(r.span,{style:{color:\"#9ECBFF\"},children:\" file\"})]})]})})}),\"\\n\",n(r.p,{children:[l(r.code,{children:\"kubectl config get-clusters\"}),\" gives us a list of k8s clusters that we've configured in \",l(r.code,{children:\"kubeconfig\"}),\".\"]})]})}return{default:function(e={}){const{wrapper:n}=e.components||{};return n?l(n,{...e,children:l(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2024/kubectl_context_management"
  },
  {
    "slug": "posts/2024/multiple_github_actions_runners",
    "title": "How To Install Multiple GitHub Self-Hosted Runners On The Same Machine",
    "description": "How to set up multiple GitHub Actions self-hosted runners on the same machine so multiple repositories can build using a free GitHub account.",
    "date": "2024-05-05T00:00:00.000Z",
    "published": true,
    "tags": [
      "gh-actions",
      "GitHub"
    ],
    "body": "const{Fragment:e,jsx:n,jsxs:r}=arguments[0];function _createMdxContent(l){const a={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h4:\"h4\",li:\"li\",mark:\"mark\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...l.components},{Image:o,Link:s}=a;return o||_missingMdxReference(\"Image\",!0),s||_missingMdxReference(\"Link\",!0),r(e,{children:[n(a.h1,{id:\"have-a-free-github-account-and-want-to-use-a-self-hosted-runner-for-more-than-one-repo\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#have-a-free-github-account-and-want-to-use-a-self-hosted-runner-for-more-than-one-repo\",children:\"Have a free GitHub account and want to use a self-hosted runner for more than one repo?\"})}),\"\\n\",n(a.p,{children:\"You have a free GitHub account and want to use the same machine (like a VPS, or a VM, or a dedicated host) to perform your CI/CD jobs.\\nUnfortunately, unless you pay GitHub and create an Organization you won't be able to configure one runner on multiple repos.\"}),\"\\n\",n(o,{src:\"/good_news_everyone.jpg\",alt:\"Good news everyone!\",width:\"500\",height:\"500\",align:\"left\",style:{width:\"100px\"},className:\"mt-0 mr-4\"}),\"\\n\",r(a.p,{children:[\"Fortunately, there is an easy solution:\\n\",n(\"br\",{}),n(a.strong,{children:\"You can install multiple runners on the same machine by installing each runner in its own folder\"})]}),\"\\n\",n(\"br\",{clear:\"left\"}),\"\\n\",n(a.p,{children:\"In this example, there are two runners on the machine, one which builds and deploys my portfolio website, and one for this blog:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"/var/actions-runners#\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" tree\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -L\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#79B8FF\"},children:\".\"})}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" corey-regan.ca\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" corey-regan.ca-blog\"})]})]})})}),\"\\n\",n(a.h2,{id:\"configure-the-self-hosted-runner-on-your-machine\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-the-self-hosted-runner-on-your-machine\",children:\"Configure the self-hosted runner on your machine\"})}),\"\\n\",n(a.h4,{id:\"pick-an-installation-directory\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#pick-an-installation-directory\",children:\"Pick an installation directory\"})}),\"\\n\",r(a.p,{children:[\"Choose where on your machine to store your runners, I chose \",n(a.code,{children:\"/var/actions-runners\"}),\".\\nI'll create the subdirectories that will contain our two runners, \",n(a.code,{children:\"corey-regan.ca\"}),\" and \",n(a.code,{children:\"corey-regan.ca-blog\"}),\", name them appropriately for your needs.\\nWe will then change its owner and apply a sticky bit to the group so that subsequently created folders and files are always owned by the \",n(a.code,{children:\"gh-runner\"}),\" group.\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mkdir\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -p\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" \\\\\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#9ECBFF\"},children:\"    /var/actions-runners/corey-regan.ca\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" \\\\\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#9ECBFF\"},children:\"    /var/actions-runners/corey-regan.ca-blog\"})})]})})}),\"\\n\",n(a.h4,{id:\"create-a-new-user--group-for-the-runner\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#create-a-new-user--group-for-the-runner\",children:\"Create a new user & group for the runner\"})}),\"\\n\",r(a.p,{children:[\"Create a new user and group for the runners, using the \",n(a.code,{children:\"-r\"}),\" flag to create a system account will have no password set,\\nno home directory, and its shell set to \",n(a.code,{children:\"/usr/sbin/nologin\"}),\", which should reduce their permissions to a minimal level necessary.\\nThis is important because the runner will be exposed to the internet, so we should attempt to mitigate this potential attack vector.\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" groupadd\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -r\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" useradd\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -r\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -g\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -s\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sbin/nologin\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"})]})]})})}),\"\\n\",n(a.h4,{id:\"apply-directory-permissions\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#apply-directory-permissions\",children:\"Apply directory permissions\"})}),\"\\n\",r(a.p,{children:[\"We'll make the \",n(a.code,{children:\"gh-runner\"}),\" user & group the owner of the installation directory,\\nand configure it so that subsequent files/folders are always owned by \",n(a.code,{children:\"gh-runner\"}),\" by applying a \",n(a.a,{href:\"https://www.redhat.com/sysadmin/suid-sgid-sticky-bit\",children:\"sticky bit to the group ownership\"}),\".\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"chown\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -R\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner:gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runners\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[r(a.mark,{\"data-highlighted-chars-mark\":\"\",\"data-highlighted-chars\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"chmod\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" g+s\"})]}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runner\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#79B8FF\"},children:\"cd\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runners\"})]})]})})}),\"\\n\",r(a.p,{children:['You can see the sticky bit applied to the directory, look for the \"',n(a.code,{children:\"S\"}),'\" in the listed permissions of the current directory.']}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"/var/actions-runners$\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ls\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -lsah\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"total\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 16K\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" \"}),n(a.mark,{\"data-highlighted-chars\":\"\",children:n(a.span,{style:{color:\"#9ECBFF\"},children:\"drwxr-Sr-x\"})}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  4\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" May\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  5\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 12:29\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" .\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" drwxr-xr-x\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 16\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" May\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  5\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 11:15\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ..\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" drwxr-xr-x\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  2\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" May\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  5\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 11:45\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" corey-regan.ca\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" drwxr-xr-x\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  5\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 4.0K\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" May\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"  5\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 12:18\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" corey-regan.ca-blog\"})]})]})})}),\"\\n\",n(a.h4,{id:\"personalized-instructions-from-github\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#personalized-instructions-from-github\",children:\"Personalized instructions from GitHub\"})}),\"\\n\",n(s,{href:\"/new_gh_runner_instructions.png\",children:n(o,{src:\"/new_gh_runner_instructions.png\",alt:\"GitHub instructions to install a new self-hosted runner\",width:\"2854\",height:\"1918\",align:\"right\",className:\"max-w-2xl ml-4\"})}),\"\\n\",n(a.p,{children:\"You can get personalized installation instructions from GitHub which includes a download link for the latest version of the runner software, as well as a secret token to securely connect the runner to GitHub.\"}),\"\\n\",r(a.p,{children:[\"Visit your GitHub repository and click on \",n(a.code,{children:\"Settings\"}),\". In the left nav bar, expand \",n(a.code,{children:\"Actions\"}),\" and click on \",n(a.code,{children:\"Runners\"}),\".\"]}),\"\\n\",r(a.p,{children:[\"Click on the \",n(a.code,{children:\"New self-hosted runner\"}),\" button in the top-right of the \",n(a.code,{children:\"Runners\"}),\" page.\"]}),\"\\n\",n(a.p,{children:\"Select the appropriate OS and architecture of the machine the runner will be installed on to generate the personalized installation instructions.\"}),\"\\n\",n(\"br\",{clear:\"right\"}),\"\\n\",n(a.p,{children:\"At this point, you should have:\"}),\"\\n\",r(a.ul,{children:[\"\\n\",n(a.li,{children:\"Downloaded the runner installation package\"}),\"\\n\",n(a.li,{children:\"Extracted the installer\"}),\"\\n\",n(a.li,{children:\"Installed the runner\"}),\"\\n\"]}),\"\\n\",n(a.h4,{id:\"runner-as-a-service\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#runner-as-a-service\",children:\"Runner-as-a-service\"})}),\"\\n\",r(a.p,{children:[\"We can configure the runner as a service to survive reboots and always start with the machine, configured to run as \",n(a.code,{children:\"gh-runner\"}),\":\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./svc.sh\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Creating\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" launch\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" runner\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" in\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc/systemd/system/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Run\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" as\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" user:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" gh-runner\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Run\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" as\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" uid:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1009\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"gid:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1009\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Created\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" symlink\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc/systemd/system/multi-user.target.wants/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc/systemd/system/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service.\"})]})]})})}),\"\\n\",n(a.p,{children:\"We also need to start the service for the first time:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./svc.sh\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" start\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"/etc/systemd/system/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"})}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" -\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" GitHub\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" Actions\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" Runner\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Invincibear-corey-regan.ca-blog.corey-regan.ca-blog)\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     Loaded:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" loaded\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (/etc/systemd/system/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service; \"}),n(a.span,{style:{color:\"#B392F0\"},children:\"enabled\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),n(a.span,{style:{color:\"#B392F0\"},children:\"vendor\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" preset:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" enabled\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     Active:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" active\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (running) since Sun 2024-05-05 13:36:19 PDT; \"}),n(a.span,{style:{color:\"#B392F0\"},children:\"23ms\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ago\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"   Main\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" PID:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1626824\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (runsvc.sh)\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"      Tasks:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 2\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (limit: \"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"9263\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     Memory:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 324.0K\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     CGroup:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /system.slice/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"             1626824\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /bin/bash\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runners/corey-regan.ca-blog/runsvc.sh\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"             1626835\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./externals/node16/bin/node\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./bin/RunnerService.js\"})]})]})})}),\"\\n\",n(a.p,{children:\"We can verify the new runner connected to GitHub by refreshing the Runners page:\"}),\"\\n\",n(s,{href:\"/new_gh_runner_connected.png\",children:n(o,{src:\"/new_gh_runner_connected.png\",alt:\"New new self-hosted GitHub runner connected to repository\",width:\"1567\",height:\"443\",className:\"max-w-2xl pr-4\"})}),\"\\n\",n(a.p,{children:\"And we can also confirm this by querying the status of the runner's service:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./svc.sh\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" status\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"/etc/systemd/system/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"})}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" -\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" GitHub\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" Actions\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" Runner\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Invincibear-corey-regan.ca-blog.corey-regan.ca-blog)\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     Loaded:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" loaded\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (/etc/systemd/system/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service; \"}),n(a.span,{style:{color:\"#B392F0\"},children:\"enabled\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),n(a.span,{style:{color:\"#B392F0\"},children:\"vendor\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" preset:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" enabled\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     Active:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" active\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (running) since Sun 2024-05-05 13:36:19 PDT; \"}),n(a.span,{style:{color:\"#B392F0\"},children:\"7s\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ago\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"   Main\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" PID:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1626824\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (runsvc.sh)\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"      Tasks:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 37\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (limit: \"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"9263\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     Memory:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" 69.7M\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"     CGroup:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /system.slice/actions.runner.Invincibear-corey-regan.ca-blog.corey-regan.ca-blog.service\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"             1626824\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /bin/bash\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runners/corey-regan.ca-blog/runsvc.sh\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"             1626835\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./externals/node16/bin/node\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" ./bin/RunnerService.js\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"             1626852\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runners/corey-regan.ca-blog/bin/Runner.Listener\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" run\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --startuptype\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" service\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"             1626878\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /var/actions-runners/corey-regan.ca-blog/bin/Runner.Worker\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" spawnclient\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 106\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 109\"})]})]})})}),\"\\n\",n(a.h2,{id:\"configure-your-github-actions-file\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-your-github-actions-file\",children:\"Configure your github-actions file\"})}),\"\\n\",n(a.p,{children:\"Congrats, you now have a self-hosted runner that GitHub can farm builds to!\\nThere is one final step though, you need to configure your workflows to use the new runner.\\nBy default, GitHub actions run on GitHub-provided servers.\\nFree accounts have a couple-thousand hours per month of free runtime for private repos, and unlimited hours for public repos.\\nPro accounts get more hours, but that may be insufficient depending on your bespoke needs.\"}),\"\\n\",n(a.p,{children:\"Self-hosted runners have no such limitations, and have the advantage of having access to other resources on the system.\\nYour runner can execute other scripts on your machine, enabling complex tasks not easily possible on GitHub-hosted runners.\"}),\"\\n\",r(a.p,{children:[\"Fortunately, it only takes one line to add to your YAML to instruct GitHub to use your self-hosted runner:\\n\",n(a.strong,{children:n(a.code,{children:\"runs-on: self-hosted\"})})]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",children:r(a.code,{\"data-language\":\"yaml\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"name\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\": \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"Deploy blog\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#79B8FF\"},children:\"on\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"  push\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"    branches\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"      - \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"main\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"jobs\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"  build_and_push_image\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"    name\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":            \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"Build and push image to GHCR.io\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"    runs-on\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\":         \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"self-hosted\"})]}),\"\\n\",r(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#85E89D\"},children:\"    timeout-minutes\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\": \"}),n(a.span,{style:{color:\"#79B8FF\"},children:\"10\"})]})]})})})]})}return{default:function(e={}){const{wrapper:r}=e.components||{};return r?n(r,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};function _missingMdxReference(e,n){throw new Error(\"Expected \"+(n?\"component\":\"object\")+\" `\"+e+\"` to be defined: you likely forgot to import, pass, or provide it.\")}",
    "slugAsParams": "2024/multiple_github_actions_runners"
  },
  {
    "slug": "posts/2024/ubuntu_22LTS_desktop_on_raid1",
    "title": "How To Install Ubuntu Desktop on RAID",
    "description": "How to install Ubuntu 22 LTS Desktop on a RAID1 array and optionally migrate an existing installation to the array",
    "date": "2024-04-20T00:00:00.000Z",
    "published": true,
    "tags": [
      "Ubuntu",
      "RAID",
      "partition",
      "GRUB",
      "initramfs"
    ],
    "body": "const{Fragment:e,jsx:n,jsxs:l}=arguments[0];function _createMdxContent(r){const a={a:\"a\",code:\"code\",figure:\"figure\",h1:\"h1\",h2:\"h2\",h3:\"h3\",li:\"li\",p:\"p\",pre:\"pre\",span:\"span\",strong:\"strong\",ul:\"ul\",...r.components};return l(e,{children:[n(a.h1,{id:\"raid1-ubuntu-desktop-how-hard-could-it-be\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#raid1-ubuntu-desktop-how-hard-could-it-be\",children:\"RAID1 Ubuntu Desktop, How Hard Could It Be?\"})}),\"\\n\",n(a.p,{children:\"You would be surprised by just how complicated it is to do something as basic as installing Ubuntu Desktop on a RAID array.\\nA lot of confusion comes from the handoff between BIOS and boot regions, unable to point to the boot files if they are in a MDADM RAID array.\\nBasically, you have to have your /boot sector as a partition of a drive, and have another partition dedicated to the RAID itself,\\nmanually managing syncing the /boot contents to your other disk(s) for peace of mind in case the disk on which you originally configured /boot fails.\"}),\"\\n\",l(a.p,{children:[\"Also, the Ubuntu Desktop installer by default does not load \",n(a.code,{children:\"mdadm\"}),\", so you have to boot to a Live install, \",n(a.code,{children:\"apt install mdadm\"}),\", then open the installer.\\nThe installer itself will also fail to set up GRUB, so you'll need to do a bunch of work to manually complete the installation process.\"]}),\"\\n\",n(a.h2,{id:\"setup-drive-partitions\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#setup-drive-partitions\",children:\"Setup drive partitions\"})}),\"\\n\",l(a.p,{children:[\"In my case, I have two Samsung 990 1TB drives (\",n(a.code,{children:\"/dev/nvme0n1\"}),\" & \",n(a.code,{children:\"/dev/nvme1n1\"}),\") that I wish to RAID1 for OS redundancy, since I've heavily customized the look and feel and don't want to lose days setting it up again.\\nIronically, it took days to get this working so that was an L on my part...\"]}),\"\\n\",n(a.p,{children:\"I will create three partitions on both drives (so they have mirrored structure).\"}),\"\\n\",l(a.ul,{children:[\"\\n\",l(a.li,{children:[n(a.code,{children:\"p1\"}),\" will be a 1G partition mounted as \",n(a.code,{children:\"/boot\"})]}),\"\\n\",l(a.li,{children:[n(a.code,{children:\"p2\"}),\" will will be a 1G partition mounted as \",n(a.code,{children:\"/boot/efi\"}),\" as a RAID1 array called \",n(a.code,{children:\"/dev/md0\"})]}),\"\\n\",l(a.li,{children:[n(a.code,{children:\"p3\"}),\" will be a partition using remaining space mounted as \",n(a.code,{children:\"/\"}),\" as a RAID1 array called \",n(a.code,{children:\"/dev/md1\"}),\".\"]}),\"\\n\",l(a.li,{children:[\"If you want to allocate the remaining disk space to different mount points instead of allocating it all to \",n(a.code,{children:\"/\"}),\", you can create additional partitions and their additional RAID1 arrays.\"]}),\"\\n\"]}),\"\\n\",n(a.p,{children:\"So to summarize, we will be creating:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"NAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"         SIZE\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  TYPE\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"   MOUNTPOINTS\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"nvme0n1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"      1T\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    disk\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"  nvme0n1p1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  1G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    part\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"   /boot/efi\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"  nvme0n1p2\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  1G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    part\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"    md0\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"      1G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    RAID1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  /boot\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"  nvme0n1p3\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  998G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  part\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"    md1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"      998G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  RAID1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  /\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"nvme1n1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"      1T\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    disk\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"  nvme1n1p1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  1G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    part\"}),n(a.span,{style:{color:\"#6A737D\"},children:\"                # You should manually sync from nvme0n1p1, later\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"  nvme1n1p2\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  1G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    part\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"    md0\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"      1G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"    RAID1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  /boot\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"  nvme1n1p3\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  998G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  part\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"    md1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"      998G\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  RAID1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"  /\"})]})]})})}),\"\\n\",n(a.p,{children:\"Let's set up the partitions, we'll set up the RAID arrays afterward. There is a more verbose version after this initial code block which explains things a bit better.\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"gdisk\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme0n1\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"o\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"y\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"n\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 2048\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"+1G\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"EF00\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"n\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 2\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 2099200\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"+1G\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"FD00\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"n\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 3\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 4196352\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#E1E4E8\"},children:\"(\"}),n(a.span,{style:{color:\"#B392F0\"},children:\"default:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" occupy\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" remaining\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" free\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" space\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"FD00\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"w\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"y\"})})]})})}),\"\\n\",n(a.p,{children:\"Here are the same commands but more verbose:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"gdisk\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme0n1\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# Create a New GPT Table (if necessary, this will erase all data on the disk):\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Command:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" o\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Confirm:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" Y\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# Create the EFI System Partition:\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Command:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" n\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (for \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"new\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" partition\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Partition\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" number:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 1\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"First\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" sector:\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Accept \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"default\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Last\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" sector:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" +1G\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Hex\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" code\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" for\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" partition\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" type:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" EF00\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (EFI \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"System\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# Create the Boot Partition (for RAID):\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Command:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" n\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (for \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"new\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" partition\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Partition\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" number:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 2\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"First\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" sector:\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Accept \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"default\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Last\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" sector:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" +1G\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Hex\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" code\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" for\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" partition\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" type:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" FD00\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Linux \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"RAID\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# Create the Root Partition (for RAID):\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Command:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" n\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (for \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"new\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" partition\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Partition\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" number:\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" 3\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"First\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" sector:\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Accept \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"default\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Last\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" sector:\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Accept \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"default,\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" which\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" uses\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" the\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" remaining\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" disk\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Hex\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" code\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" for\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" partition\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" type:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" FD00\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" (Linux \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"RAID\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# Write the Table to Disk and Exit:\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Command:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" w\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"Confirm:\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" Y\"})]})]})})}),\"\\n\",n(a.p,{children:\"Now repeat these steps for the other disk(s).\"}),\"\\n\",l(a.p,{children:[\"You might need to reboot at this point for the Linux Live environment to pick up on these changes, I did, if you don't see the new partitions using \",n(a.code,{children:\"lsblk\"}),\" then reboot the system.\"]}),\"\\n\",n(a.h2,{id:\"setting-up-mdadm-software-raid-arrays\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#setting-up-mdadm-software-raid-arrays\",children:\"Setting up MDADM software RAID arrays\"})}),\"\\n\",l(a.p,{children:[\"The Ubuntu Live environment, and by extension it's installer, do not load MDADM by default, meaning there is no software RAID support out of the box, even if you've previously created RAID arrays and want to re-use them.\\nOddly, this support is already baked into the Ubuntu Server installer, just not the Ubuntu Desktop installer.\\nNo worries, that's as easy as opening a Terminal window and running \",n(a.code,{children:\"apt install mdadm\"}),\".\"]}),\"\\n\",l(a.p,{children:[\"Once MDADM is installed, we can go ahead and create the two RAID1 arrays, where \",n(a.code,{children:\"/dev/md0\"}),\" will be mounted to \",n(a.code,{children:\"/boot/efi\"}),\", and \",n(a.code,{children:\"dev/md1\"}),\" will be mounted to \",n(a.code,{children:\"/\"}),\".\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mdadm\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --create\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --verbose\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md0\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --level=1\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --raid-devices=2\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme0n1p2\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme1n1p2\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mdadm\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --create\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --verbose\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md1\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --level=1\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --raid-devices=2\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme0n1p3\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme1n1p3\"})]})]})})}),\"\\n\",n(a.h2,{id:\"format-the-partitions\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#format-the-partitions\",children:\"Format the partitions\"})}),\"\\n\",n(a.p,{children:\"Format the EFI partitions on each disk:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mkfs.vfat\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme0n1p1\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mkfs.vfat\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme1n1p1\"})]})]})})}),\"\\n\",n(a.p,{children:\"Format the RAID partitions, you can use XFS or another filesystem if you prefer:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mkfs.ext4\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md0\"}),n(a.span,{style:{color:\"#6A737D\"},children:\"  # for /boot\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mkfs.ext4\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md1\"}),n(a.span,{style:{color:\"#6A737D\"},children:\"  # for /\"})]})]})})}),\"\\n\",n(a.h2,{id:\"install-ubuntu\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#install-ubuntu\",children:\"Install Ubuntu\"})}),\"\\n\",l(a.p,{children:[\"Now you want to launch to Ubuntu installer. When it asks you where to install Ubuntu, select \",n(a.code,{children:\"something else\"}),\" to manually configure the disks.\"]}),\"\\n\",l(a.ul,{children:[\"\\n\",l(a.li,{children:[\"Mount \",n(a.code,{children:\"/dev/md0\"}),\" to \",n(a.code,{children:\"/boot\"}),\", with type \",n(a.code,{children:\"ext4\"}),\", format the partition\"]}),\"\\n\",l(a.li,{children:[\"Mount \",n(a.code,{children:\"/dev/md1\"}),\" to \",n(a.code,{children:\"/\"}),\", with type \",n(a.code,{children:\"ext4\"}),\", format the partition\"]}),\"\\n\",l(a.li,{children:[\"Use \",n(a.code,{children:\"/dev/nvme0n1p1\"}),\" as \",n(a.code,{children:\"EFI System Partition\"})]}),\"\\n\",l(a.li,{children:[\"Use \",n(a.code,{children:\"/dev/nvme1n1p1\"}),\" as \",n(a.code,{children:\"EFI System Partition\"})]}),\"\\n\",l(a.li,{children:[\"Use \",n(a.code,{children:\"/dev/nvme0n1\"}),\" as the device for bootloader installation. This part doesn't matter since it will fail anyway, and we will be manually copying its contents to the other disk once it is properly setup.\"]}),\"\\n\"]}),\"\\n\",l(a.p,{children:[\"Install Ubuntu as much as you can until it \",n(a.strong,{children:\"probably\"}),\" fails.\"]}),\"\\n\",n(a.h2,{id:\"configure-grub\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#configure-grub\",children:\"Configure GRUB\"})}),\"\\n\",l(a.p,{children:[\"I lost track of the steps in the days of getting this all to work, you might need to reboot to the Ubuntu Live environment again, or not, and possibly reinstall \",n(a.code,{children:\"mdadm\"}),\" again, and have it rescan for RAID arrays.\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" apt\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mdadm\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mdadm\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --assemble\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --scan\"})]})]})})}),\"\\n\",n(a.p,{children:\"Create mount point:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mkdir\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root\"})]})})})}),\"\\n\",n(a.p,{children:\"Mount the root and boot partitions:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md0\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root/boot\"})]})]})})}),\"\\n\",n(a.p,{children:\"Mount the EFI system partition:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvmd0n1p1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root/boot/efi\"})]})})})}),\"\\n\",n(a.p,{children:\"Chroot into the mounted install:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#F97583\"},children:\"for\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" i \"}),n(a.span,{style:{color:\"#F97583\"},children:\"in\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/pts\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /proc\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sys\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /run\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"do\"}),n(a.span,{style:{color:\"#B392F0\"},children:\" sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mount\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -B\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" $i \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/mnt/root\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$i; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"done\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mount\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -t\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" efivarfs\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" efivarfs\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sys/firmware/efi/efivars\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"chroot\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root\"})]})]})})}),\"\\n\",n(a.p,{children:\"Update GRUB and initramfs:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#79B8FF\"},children:\"echo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" raid1\"}),n(a.span,{style:{color:\"#F97583\"},children:\" >>\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc/modules\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"update-initramfs\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -u\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"update-grub2\"})})]})})}),\"\\n\",n(a.p,{children:\"Install GRUB to both disks:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"grub-install\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --target=x86_64-efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --efi-directory=/boot/efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --bootloader-id=Ubuntu\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /boot/efi\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme1n1p1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /boot/efi\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"grub-install\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --target=x86_64-efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --efi-directory=/boot/efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --bootloader-id=Ubuntu\"})]})]})})}),\"\\n\",n(a.p,{children:\"Verify boot options:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"efibootmgr\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:\" \"}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# If you need to change the default, use\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" efibootmgr\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -o\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" xxxx,yyyy\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#6A737D\"},children:\"# where xxxx,yyyy are the IDs of the boot devices whose order you want to rearrange\"})})]})})}),\"\\n\",n(a.p,{children:\"Exit from chroot, unmount everything, and reboot:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#79B8FF\"},children:\"exit\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#F97583\"},children:\"for\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" i \"}),n(a.span,{style:{color:\"#F97583\"},children:\"in\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sys\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /proc\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/pts\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /run\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"do\"}),n(a.span,{style:{color:\"#B392F0\"},children:\" sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$i; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"done\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root/boot/efi\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root/boot\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/root\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" reboot\"})]})]})})}),\"\\n\",l(a.p,{children:[\"You should now be able to boot into a fresh install of Ubuntu. I noticed though that GRUB takes 30 seconds to auto-boot into Ubuntu, which we can fix.\\nThe config already has the correct values, but they are overridden by GRUB-installed configs in \",n(a.code,{children:\"/etc/grub.d/\"}),\", so we just need to add a couple of settings into a custom GRUB config and rebuild GRUB:\"]}),\"\\n\",l(a.p,{children:[n(a.code,{children:\"/etc/grub.d/99_custom\"}),\":\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"cat\"}),n(a.span,{style:{color:\"#F97583\"},children:\" <<\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" EOF\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#9ECBFF\"},children:\"set timeout=0\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#9ECBFF\"},children:\"set timeout_style=hidden\"})}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#9ECBFF\"},children:\"EOF\"})})]})})}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" chmod\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" +x\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc/grub.d/99_custom\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" update-grub2\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" reboot\"})]})]})})}),\"\\n\",n(a.h2,{id:\"bonus-migrate-existing-ubuntu-instance-to-new-raid1-instance\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#bonus-migrate-existing-ubuntu-instance-to-new-raid1-instance\",children:\"Bonus: migrate existing Ubuntu instance to new RAID1 instance\"})}),\"\\n\",n(a.p,{children:\"In my case I wanted to replace my 250GB drive with a RAID1 1TB disk. Here are the additional steps used to migrate the system. This assumes the version of Ubuntu installed is the same major version.\"}),\"\\n\",n(a.p,{children:\"The rough steps are:\"}),\"\\n\",l(a.ul,{children:[\"\\n\",n(a.li,{children:\"Boot into old single-drive Ubuntu instance\"}),\"\\n\",l(a.li,{children:[\"Mount RAID disks to \",n(a.code,{children:\"/mnt\"}),\" and \",n(a.code,{children:\"/mnt/boot\"})]}),\"\\n\",l(a.li,{children:[\"Mount EFI system to \",n(a.code,{children:\"/mnt/boot/efi\"})]}),\"\\n\",l(a.li,{children:[\"Use \",n(a.code,{children:\"rsync\"}),\" to safely copy file from old to new Ubuntu instance\"]}),\"\\n\",l(a.li,{children:[n(a.code,{children:\"chroot\"}),\" into new install and reconfigure boot\"]}),\"\\n\"]}),\"\\n\",l(a.p,{children:[\"In my case, Ubuntu auto-mounted the root RAID1 partition to \",n(a.code,{children:\"/media/$USERNAME/$UUID\"}),\" (where \",n(a.code,{children:\"$USERNAME\"}),\" is the username supplied during the Ubuntu install, and \",n(a.code,{children:\"$UUID\"}),\" is the UUID of the root RAID1 array),\\nso I simply mounted the other two partitions following that path\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/md126\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /media/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$USERNAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$UUID\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/boot\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme0n1p1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /media/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$USERNAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$UUID\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/boot/efi\"})]})]})})}),\"\\n\",l(a.p,{children:[\"Backup the \",n(a.code,{children:\"/etc\"}),\" folder of the RAID1 root partition, just in case:\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"cp\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -r\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /media/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$USERNAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$UUID\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/etc{,.bak}\"})]})})})}),\"\\n\",l(a.p,{children:[\"You should remove old versions of initramfs from \",n(a.code,{children:\"/boot\"}),\" before running the \",n(a.code,{children:\"rsync\"}),\" command, especially if the source \",n(a.code,{children:\"/boot\"}),\" is larger than the destination \",n(a.code,{children:\"/boot\"}),\".\\nI suggest keeping the two most recent versions.\"]}),\"\\n\",l(a.p,{children:[\"Copy files from old Ubuntu instance to new RAID1 instance. You'll notice \",n(a.code,{children:\"/etc\"}),\" isn't excluded:\"]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" rsync\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" \\\\\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#79B8FF\"},children:\"    -aAXHv\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" \\\\\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#79B8FF\"},children:\"    --exclude=\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"{\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/dev/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/proc/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/sys/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/tmp/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/run/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/mnt/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/media/*\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\",\"}),n(a.span,{style:{color:\"#B392F0\"},children:'\"/lost+found\"'}),n(a.span,{style:{color:\"#B392F0\"},children:\"}\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" \\\\\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#9ECBFF\"},children:\"    /\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /media/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$USERNAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$UUID\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"})]})]})})}),\"\\n\",n(a.p,{children:\"Chroot into the new instance:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#F97583\"},children:\"for\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" i \"}),n(a.span,{style:{color:\"#F97583\"},children:\"in\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/pts\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /proc\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sys\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /run\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"do\"}),n(a.span,{style:{color:\"#B392F0\"},children:\" sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mount\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -B\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" $i \"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/media/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$USERNAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$UUID$i; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"done\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" chroot\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /media/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$USERNAME\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\"/\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$UUID\"})]})]})})}),\"\\n\",l(a.p,{children:[\"Restore \",n(a.code,{children:\"/etc/fstab\"}),\" from \",n(a.code,{children:\"/etc.bak/fstab\"})]}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:n(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"cp\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc.bak/fstab\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /etc/fstab\"})]})})})}),\"\\n\",n(a.p,{children:\"Re-install GRUB to both disks:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" mount\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" -t\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" efivarfs\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" efivarfs\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sys/firmware/efi/efivars\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"grub-install\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --target=x86_64-efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --efi-directory=/boot/efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --bootloader-id=Ubuntu\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"update-grub2\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /boot/efi\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"mount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/nvme1n1p1\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /boot/efi\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"grub-install\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --target=x86_64-efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --efi-directory=/boot/efi\"}),n(a.span,{style:{color:\"#79B8FF\"},children:\" --bootloader-id=Ubuntu\"})]}),\"\\n\",n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#B392F0\"},children:\"update-grub2\"})})]})})}),\"\\n\",n(a.p,{children:\"Exit chroot, unmount everything, reboot to new Ubuntu RAID1 instance:\"}),\"\\n\",n(a.figure,{\"data-rehype-pretty-code-figure\":\"\",children:n(a.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark\",children:l(a.code,{\"data-language\":\"bash\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[n(a.span,{\"data-line\":\"\",children:n(a.span,{style:{color:\"#79B8FF\"},children:\"exit\"})}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#F97583\"},children:\"for\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\" i \"}),n(a.span,{style:{color:\"#F97583\"},children:\"in\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /run\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /sys\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /proc\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev/pts\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /dev\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"do\"}),n(a.span,{style:{color:\"#B392F0\"},children:\" sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt\"}),n(a.span,{style:{color:\"#E1E4E8\"},children:\"$i; \"}),n(a.span,{style:{color:\"#F97583\"},children:\"done\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" umount\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/boot/efi\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt/boot\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" /mnt\"})]}),\"\\n\",l(a.span,{\"data-line\":\"\",children:[n(a.span,{style:{color:\"#B392F0\"},children:\"sudo\"}),n(a.span,{style:{color:\"#9ECBFF\"},children:\" reboot\"})]})]})})}),\"\\n\",n(a.h3,{id:\"sources\",children:n(a.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#sources\",children:\"Sources:\"})}),\"\\n\",n(a.p,{children:\"Many thanks for putting me on the right track:\"}),\"\\n\",l(a.ul,{children:[\"\\n\",l(a.li,{children:[\"Wendell @ \",n(a.a,{href:\"https://www.level1techs.com\",children:\"Level1Techs\"}),\"\\n\",l(a.ul,{children:[\"\\n\",n(a.li,{children:n(a.a,{href:\"https://www.youtube.com/watch?v=F4YIxh1kkhI\",children:\"https://www.youtube.com/watch?v=F4YIxh1kkhI\"})}),\"\\n\",n(a.li,{children:n(a.a,{href:\"https://forum.level1techs.com/t/how-to-install-ubuntu-20-04-to-linux-me-raid/154105\",children:\"https://forum.level1techs.com/t/how-to-install-ubuntu-20-04-to-linux-me-raid/154105\"})}),\"\\n\"]}),\"\\n\"]}),\"\\n\",n(a.li,{children:n(a.a,{href:\"https://www.youtube.com/watch?v=rJzHpc1kQW4\",children:\"https://www.youtube.com/watch?v=rJzHpc1kQW4\"})}),\"\\n\",n(a.li,{children:n(a.a,{href:\"https://superuser.com/a/1020807\",children:\"https://superuser.com/questions/1020806/how-to-install-ubuntu-15-10-on-an-encrypted-raid-1\"})}),\"\\n\"]})]})}return{default:function(e={}){const{wrapper:l}=e.components||{};return l?n(l,{...e,children:n(_createMdxContent,{...e})}):_createMdxContent(e)}};",
    "slugAsParams": "2024/ubuntu_22LTS_desktop_on_raid1"
  }
]